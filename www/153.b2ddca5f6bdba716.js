"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[153],{8153:(Q,h,i)=>{i.r(h),i.d(h,{UsersModule:()=>$});var f=i(177),b=i(2365),d=i(467),e=i(4438),p=i(5779),x=i(5373),c=i(6432),C=i(1570),R=i(563),g=i(1141),j=i(9998),v=i(1830),U=i(4799),_=i(2242),k=i(1579),M=i(9883),m=i(4341),T=i(229);const I=()=>["id_user","username"],B=()=>({"min-width":"75rem"}),G=()=>({width:"40rem"}),F=()=>({height:"6px"});function y(a,r){if(1&a){const n=e.RV6();e.j41(0,"p-button",13),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.create_new())}),e.k0s()}if(2&a){const n=e.XpG();e.Y8G("disabled",!n.isAdmin())}}function D(a,r){1&a&&(e.j41(0,"div",14),e.nrm(1,"p-progressBar",15),e.k0s()),2&a&&(e.R7$(),e.Aen(e.lJ4(2,F)))}function S(a,r){if(1&a){const n=e.RV6();e.j41(0,"div",16)(1,"h5",17),e.EFF(2,"Manage Users"),e.k0s(),e.j41(3,"span",18),e.nrm(4,"i",19),e.j41(5,"input",20),e.bIt("input",function(t){e.eBV(n),e.XpG();const o=e.sdS(8);return e.Njj(o.filterGlobal(t.target.value,"contains"))}),e.k0s()()()}}function E(a,r){1&a&&(e.j41(0,"tr"),e.nrm(1,"th"),e.j41(2,"th",21),e.EFF(3," USERNAME "),e.nrm(4,"p-sortIcon",22),e.k0s(),e.j41(5,"th",23),e.EFF(6," ROLE "),e.nrm(7,"p-sortIcon",24),e.k0s(),e.j41(8,"th"),e.EFF(9,"Action"),e.k0s()())}function V(a,r){if(1&a){const n=e.RV6();e.j41(0,"tr"),e.nrm(1,"td"),e.j41(2,"td"),e.EFF(3),e.k0s(),e.j41(4,"td"),e.EFF(5),e.k0s(),e.j41(6,"td")(7,"button",25),e.bIt("click",function(){const t=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.update_data(t))}),e.k0s(),e.j41(8,"button",26),e.bIt("click",function(t){const o=e.eBV(n).$implicit,u=e.XpG();return e.Njj(u.confirm(t,o))}),e.k0s()()()}if(2&a){const n=r.$implicit,s=e.XpG();e.R7$(3),e.JRh(n.username),e.R7$(2),e.JRh(n.role_perm),e.R7$(3),e.Y8G("outlined",!0)("disabled",!s.isAdmin())}}function N(a,r){if(1&a){const n=e.RV6();e.j41(0,"div",27)(1,"label",28)(2,"h6",29),e.EFF(3,"Username"),e.k0s()(),e.j41(4,"input",30),e.mxI("ngModelChange",function(t){e.eBV(n);const o=e.XpG();return e.DH7(o.username,t)||(o.username=t),e.Njj(t)}),e.k0s()(),e.j41(5,"div",31)(6,"label",32)(7,"h6",29),e.EFF(8,"Password"),e.k0s()(),e.j41(9,"p-password",33),e.mxI("ngModelChange",function(t){e.eBV(n);const o=e.XpG();return e.DH7(o.password,t)||(o.password=t),e.Njj(t)}),e.k0s()(),e.j41(10,"div",31)(11,"label",34)(12,"h6",29),e.EFF(13,"Role Access"),e.k0s()(),e.j41(14,"p-dropdown",35),e.mxI("ngModelChange",function(t){e.eBV(n);const o=e.XpG();return e.DH7(o.selectedRole,t)||(o.selectedRole=t),e.Njj(t)}),e.bIt("onChange",function(t){e.eBV(n);const o=e.XpG();return e.Njj(o.onRoleSelected(t))}),e.k0s()(),e.j41(15,"div",31)(16,"label",36)(17,"h6",29),e.EFF(18,"Role Description"),e.k0s()(),e.j41(19,"input",37),e.mxI("ngModelChange",function(t){e.eBV(n);const o=e.XpG();return e.DH7(o.descriptionRole,t)||(o.descriptionRole=t),e.Njj(t)}),e.k0s()()}if(2&a){const n=e.XpG();e.R7$(4),e.R50("ngModel",n.username),e.R7$(5),e.R50("ngModel",n.password),e.Y8G("toggleMask",!0),e.R7$(5),e.Y8G("options",n.role_access),e.R50("ngModel",n.selectedRole),e.Y8G("checkmark",!0)("showClear",!0),e.R7$(5),e.R50("ngModel",n.descriptionRole),e.Y8G("disabled",!0)}}function X(a,r){if(1&a){const n=e.RV6();e.j41(0,"button",38),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.close_add_dialog())}),e.k0s(),e.j41(1,"button",39),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.add_user())}),e.k0s()}}function A(a,r){if(1&a){const n=e.RV6();e.j41(0,"div",27)(1,"label",28)(2,"h6",29),e.EFF(3,"Username"),e.k0s()(),e.j41(4,"input",40),e.mxI("ngModelChange",function(t){e.eBV(n);const o=e.XpG();return e.DH7(o.data_update.username,t)||(o.data_update.username=t),e.Njj(t)}),e.k0s()(),e.j41(5,"div",31)(6,"label",34)(7,"h6",29),e.EFF(8,"Role Access"),e.k0s()(),e.j41(9,"p-dropdown",41),e.mxI("ngModelChange",function(t){e.eBV(n);const o=e.XpG();return e.DH7(o.data_update.role_perm,t)||(o.data_update.role_perm=t),e.Njj(t)}),e.bIt("onChange",function(t){e.eBV(n);const o=e.XpG();return e.Njj(o.onRoleChange(t))}),e.k0s()(),e.j41(10,"div",31)(11,"label",36)(12,"h6",29),e.EFF(13,"Role Description"),e.k0s()(),e.j41(14,"input",37),e.mxI("ngModelChange",function(t){e.eBV(n);const o=e.XpG();return e.DH7(o.data_update.description,t)||(o.data_update.description=t),e.Njj(t)}),e.k0s()()}if(2&a){const n=e.XpG();e.R7$(4),e.R50("ngModel",n.data_update.username),e.Y8G("disabled",!0),e.R7$(5),e.Y8G("options",n.roleList),e.R50("ngModel",n.data_update.role_perm),e.Y8G("showClear",!0),e.R7$(5),e.R50("ngModel",n.data_update.description),e.Y8G("disabled",!0)}}function w(a,r){if(1&a){const n=e.RV6();e.j41(0,"button",38),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.close_edit_dialog())}),e.k0s(),e.j41(1,"button",39),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.updating(t.data_update))}),e.k0s()}}let Y=(()=>{class a{constructor(n,s,t){this.messageService=n,this.api=s,this.confirmationService=t,this.users=[],this.selectedUsers=[],this.loadingUsername=!1,this.role_access=[],this.data_update={username:null,role_perm:null,description:""},this.roleList=[{value:"5",label:"Manager",description:"Bisa manage seluruh data, user, dan laporan."},{value:"6",label:"Admin",description:"Bisa akses dan ubah data, tapi tidak bisa hapus user."},{value:"7",label:"User",description:"Hanya bisa lihat data tanpa akses untuk mengubah."}]}ngOnInit(){this.initialAPI()}initialAPI(){var n=this;return(0,d.A)(function*(){yield n.get_user(),yield n.isAdmin(),yield n.get_role_access()})()}service_message(n,s,t){this.messageService.add({severity:n,summary:s,detail:t})}onRoleChange(n){const s=this.roleList.find(t=>t.value===n.value);this.data_update.description=s?s.description:""}onRoleSelected(n){const s=this.roleList.find(t=>t.value===n.value.id_access);this.descriptionRole=s?s.description:""}get_user(){var n=this;return(0,d.A)(function*(){n.api.users_get().then(s=>{n.users=s.data}).catch(s=>{console.log(s),n.service_message("warn","ERROR","Tidak Ada Data yang Ditampilkan")})})()}get_role_access(){var n=this;return(0,d.A)(function*(){n.api.role_get().then(s=>{n.role_access=s.data}).catch(s=>{console.log(s)})})()}create_new(){this.add_dialog=!0}isAdmin(){return(0,d.A)(function*(){return"manager"===localStorage.getItem("_rolePerm")})()}generateRandomId(n){let t="";for(let o=0;o<n;o++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t}add_user(){if(!this.username&&!this.password)return void this.service_message("error","ERROR","Form Cannot be Blank!");const n={id_user:this.generateRandomId(10),username:this.username,password:this.password,id_access:this.selectedRole.id_access,modified_by:JSON.parse(localStorage.getItem("_userInfo")).username};this.api.insertUser_post(n).then(s=>{200==s.status?(this.service_message("success","SUCCESS","Berhasil Menambahkan User"),this.add_dialog=!1,this.username=null,this.password=null,this.selectedRole=null,this.get_user()):400==s.status&&this.service_message("warn","ERROR","Username sudah ada")}).catch(s=>{console.log(s),this.service_message("warn","ERROR","Gagal Menambahkan User")})}close_add_dialog(){this.add_dialog=!1,this.username=null,this.password=null,this.selectedRole=null}update_data(n){this.edit_dialog=!0,this.data_update={...n}}updating(n){this.api.updateUser_post({username:n.username,role_access_id:n.role_perm}).then(t=>{console.log(t),this.service_message("success","SUCCESS","Berhasil Update Data"),this.get_user(),this.close_edit_dialog()}).catch(t=>{console.log(t),this.service_message("warn","ERROR","Gagal Update Data / Tidak Ada Data yang Dirubah")})}close_edit_dialog(){this.edit_dialog=!1,this.data_update=null}confirm(n,s){this.confirmationService.confirm({target:n.target,message:"Do you want to delete this record?",header:"Delete Confirmation",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger p-button-text",rejectButtonStyleClass:"p-button-text p-button-text",acceptIcon:"none",rejectIcon:"none",accept:()=>{this.api.deleteUser_post({username:s.username}).then(t=>{this.service_message("info","Confirmed","Record Telah Dihapus"),this.get_user()}).catch(t=>{this.service_message("error","Failed","Gagal Menghapus Data")}),this.get_user()},reject:()=>{this.service_message("error","Rejected","Batal Menghapus Data")}})}static{this.\u0275fac=function(s){return new(s||a)(e.rXU(p.bg),e.rXU(x.G),e.rXU(p.td))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-users"]],decls:18,vars:27,consts:[["dt",""],[1,"col-12","card"],["styleClass","mb-4 gap-2"],["pTemplate","left"],["class","col-12",4,"ngIf"],["dataKey","username","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"selectionChange","value","rows","paginator","globalFilterFields","tableStyle","selection","rowHover","showCurrentPageReport"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["p-dialog","","header","Add User",3,"visibleChange","modal","draggable","visible","resizable","closable"],["pTemplate","content"],["pTemplate","footer"],["p-dialog","","header","Edit User",3,"visibleChange","modal","draggable","visible","resizable","closable"],["pRipple","","severity","success","label","Add User","icon","pi pi-user-plus",1,"mr-2",3,"click","disabled"],[1,"col-12"],["mode","indeterminate"],[1,"flex","align-items-center","justify-content-between"],[1,"m-0"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Search...",3,"input"],["pSortableColumn","username"],["field","username"],["pSortableColumn","role_perm"],["field","role_perm"],["pButton","","pRipple","","icon","pi pi-pencil",1,"mr-2","p-button-rounded","p-button-warn","p-button-outlined",3,"click"],["pButton","","pRipple","","icon","pi pi-trash","severity","danger",1,"ml-2","p-button-rounded","p-button-danger","p-button-outlined",3,"click","outlined","disabled"],[1,"p-fluid"],["for","username"],[2,"font-weight","bold"],["type","text","pInputText","","id","username",3,"ngModelChange","ngModel"],[1,"p-fluid","mt-3"],["for","password"],[3,"ngModelChange","ngModel","toggleMask"],["for","Role Access"],["appendTo","body","optionLabel","role_perm","placeholder","Select a Role",3,"ngModelChange","onChange","options","ngModel","checkmark","showClear"],["for","Role Description"],["type","text","pInputText","","id","Role Description",3,"ngModelChange","ngModel","disabled"],["pButton","","pRipple","","label","Cancel","icon","pi pi-times",1,"p-button-text",3,"click"],["pButton","","pRipple","","label","Save","icon","pi pi-check",1,"p-button-text",3,"click"],["type","text","pInputText","","id","username",3,"ngModelChange","ngModel","disabled"],["appendTo","body","optionLabel","label","optionValue","value","placeholder","Select a Role",3,"ngModelChange","onChange","options","ngModel","showClear"]],template:function(s,t){if(1&s){const o=e.RV6();e.nrm(0,"p-toast")(1,"p-confirmDialog"),e.j41(2,"div",1)(3,"p-toolbar",2),e.DNE(4,y,1,1,"ng-template",3),e.k0s()(),e.DNE(5,D,2,3,"div",4),e.j41(6,"div",1)(7,"p-table",5,0),e.mxI("selectionChange",function(l){return e.eBV(o),e.DH7(t.selectedUsers,l)||(t.selectedUsers=l),e.Njj(l)}),e.DNE(9,S,6,0,"ng-template",6)(10,E,10,0,"ng-template",7)(11,V,9,4,"ng-template",8),e.k0s()(),e.j41(12,"p-dialog",9),e.mxI("visibleChange",function(l){return e.eBV(o),e.DH7(t.add_dialog,l)||(t.add_dialog=l),e.Njj(l)}),e.DNE(13,N,20,9,"ng-template",10)(14,X,2,0,"ng-template",11),e.k0s(),e.j41(15,"p-dialog",12),e.mxI("visibleChange",function(l){return e.eBV(o),e.DH7(t.edit_dialog,l)||(t.edit_dialog=l),e.Njj(l)}),e.DNE(16,A,15,7,"ng-template",10)(17,w,2,0,"ng-template",11),e.k0s()}2&s&&(e.R7$(5),e.Y8G("ngIf",t.loadingUsername),e.R7$(2),e.Y8G("value",t.users)("rows",10)("paginator",!0)("globalFilterFields",e.lJ4(23,I))("tableStyle",e.lJ4(24,B)),e.R50("selection",t.selectedUsers),e.Y8G("rowHover",!0)("showCurrentPageReport",!0),e.R7$(5),e.Aen(e.lJ4(25,G)),e.Y8G("modal",!0)("draggable",!1),e.R50("visible",t.add_dialog),e.Y8G("resizable",!1)("closable",!1),e.R7$(3),e.Aen(e.lJ4(26,G)),e.Y8G("modal",!0)("draggable",!1),e.R50("visible",t.edit_dialog),e.Y8G("resizable",!1)("closable",!1))},dependencies:[f.bT,c.XI,p.Ei,c.Tg,c.yc,C.l,R.n,g._f,g.$n,j.y8,v.M,U.T,_.S,k.z,M.ms,m.me,m.BC,m.vS,T._2]})}}return a})(),H=(()=>{class a{static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[b.iI.forChild([{path:"",component:Y}]),b.iI]})}}return a})();var O=i(1305),P=i(1599),J=i(102),L=i(935),z=i(494),K=i(4714),Z=i(981);let $=(()=>{class a{static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({providers:[p.bg,p.td,J.b],imports:[f.MD,H,c.bG,C.P,R.Z,g.tm,j.MB,v.m,U.F,_.u,O.f,P.e,M.kr,L.$,z.Ko,K.wZ,_.u,m.YN,Z.O3,k.d,T.Ou]})}}return a})()}}]);