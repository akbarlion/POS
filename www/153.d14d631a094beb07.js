"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[153],{8153:(Q,h,l)=>{l.r(h),l.d(h,{UsersModule:()=>Z});var f=l(177),b=l(2365),c=l(467),e=l(4438),d=l(5779),x=l(5373),p=l(6432),C=l(1570),R=l(563),g=l(1141),j=l(9998),v=l(1830),U=l(4799),_=l(2242),k=l(1579),T=l(9883),m=l(4341),M=l(229);const I=()=>["id_user","username"],y=()=>({"min-width":"75rem"}),G=()=>({width:"40rem"}),B=()=>({height:"6px"});function F(a,r){if(1&a){const t=e.RV6();e.j41(0,"p-button",13),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.create_new())}),e.k0s(),e.nrm(1,"p-button",14)}if(2&a){const t=e.XpG();e.Y8G("disabled",!t.isAdmin()),e.R7$(),e.Y8G("disabled",!t.selectedUsers||!t.selectedUsers.length)}}function D(a,r){1&a&&(e.j41(0,"div",15),e.nrm(1,"p-progressBar",16),e.k0s()),2&a&&(e.R7$(),e.Aen(e.lJ4(2,B)))}function S(a,r){if(1&a){const t=e.RV6();e.j41(0,"div",17)(1,"h5",18),e.EFF(2,"Manage Users"),e.k0s(),e.j41(3,"span",19),e.nrm(4,"i",20),e.j41(5,"input",21),e.bIt("input",function(n){e.eBV(t),e.XpG();const o=e.sdS(8);return e.Njj(o.filterGlobal(n.target.value,"contains"))}),e.k0s()()()}}function E(a,r){1&a&&(e.j41(0,"tr")(1,"th"),e.nrm(2,"p-tableHeaderCheckbox"),e.k0s(),e.j41(3,"th",22),e.EFF(4," USERNAME "),e.nrm(5,"p-sortIcon",23),e.k0s(),e.j41(6,"th",24),e.EFF(7," ROLE "),e.nrm(8,"p-sortIcon",25),e.k0s(),e.j41(9,"th"),e.EFF(10,"Action"),e.k0s()())}function V(a,r){if(1&a){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.nrm(2,"p-tableCheckbox",26),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td")(8,"button",27),e.bIt("click",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.update_data(n))}),e.k0s(),e.j41(9,"button",28),e.bIt("click",function(n){const o=e.eBV(t).$implicit,u=e.XpG();return e.Njj(u.confirm(n,o))}),e.k0s()()()}if(2&a){const t=r.$implicit,s=e.XpG();e.R7$(2),e.Y8G("value",t),e.R7$(2),e.JRh(t.username),e.R7$(2),e.JRh(t.role_perm),e.R7$(3),e.Y8G("outlined",!0)("disabled",!s.isAdmin())}}function N(a,r){if(1&a){const t=e.RV6();e.j41(0,"div",29)(1,"label",30)(2,"h6",31),e.EFF(3,"Username"),e.k0s()(),e.j41(4,"input",32),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.username,n)||(o.username=n),e.Njj(n)}),e.k0s()(),e.j41(5,"div",33)(6,"label",34)(7,"h6",31),e.EFF(8,"Password"),e.k0s()(),e.j41(9,"p-password",35),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.password,n)||(o.password=n),e.Njj(n)}),e.k0s()(),e.j41(10,"div",33)(11,"label",36)(12,"h6",31),e.EFF(13,"Role Access"),e.k0s()(),e.j41(14,"p-dropdown",37),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.selectedRole,n)||(o.selectedRole=n),e.Njj(n)}),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(4),e.R50("ngModel",t.username),e.R7$(5),e.R50("ngModel",t.password),e.Y8G("toggleMask",!0),e.R7$(5),e.Y8G("options",t.role_access),e.R50("ngModel",t.selectedRole),e.Y8G("checkmark",!0)("showClear",!0)}}function A(a,r){if(1&a){const t=e.RV6();e.j41(0,"button",38),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.close_add_dialog())}),e.k0s(),e.j41(1,"button",39),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.add_user())}),e.k0s()}}function X(a,r){if(1&a){const t=e.RV6();e.j41(0,"div",29)(1,"label",30)(2,"h6",31),e.EFF(3,"Username"),e.k0s()(),e.j41(4,"input",40),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.data_update.username,n)||(o.data_update.username=n),e.Njj(n)}),e.k0s()(),e.j41(5,"div",33)(6,"label",36)(7,"h6",31),e.EFF(8,"Role Access"),e.k0s()(),e.j41(9,"p-dropdown",41),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.data_update.role_perm,n)||(o.data_update.role_perm=n),e.Njj(n)}),e.bIt("onChange",function(n){e.eBV(t);const o=e.XpG();return e.Njj(o.onRoleChange(n))}),e.k0s()(),e.j41(10,"div",33)(11,"label",42)(12,"h6",31),e.EFF(13,"Role Description"),e.k0s()(),e.j41(14,"input",43),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.data_update.description,n)||(o.data_update.description=n),e.Njj(n)}),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(4),e.R50("ngModel",t.data_update.username),e.Y8G("disabled",!0),e.R7$(5),e.Y8G("options",t.roleList),e.R50("ngModel",t.data_update.role_perm),e.Y8G("showClear",!0),e.R7$(5),e.R50("ngModel",t.data_update.description),e.Y8G("disabled",!0)}}function w(a,r){if(1&a){const t=e.RV6();e.j41(0,"button",38),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.close_edit_dialog())}),e.k0s(),e.j41(1,"button",39),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.updating(n.data_update))}),e.k0s()}}let Y=(()=>{class a{constructor(t,s,n){this.messageService=t,this.api=s,this.confirmationService=n,this.users=[],this.selectedUsers=[],this.loadingUsername=!1,this.role_access=[],this.data_update={username:null,role_perm:null,description:""},this.roleList=[{value:"5",label:"Manager",description:"Bisa manage seluruh data, user, dan laporan."},{value:"6",label:"Admin",description:"Bisa akses dan ubah data, tapi tidak bisa hapus user."},{value:"7",label:"User",description:"Hanya bisa lihat data tanpa akses untuk mengubah."}]}ngOnInit(){this.initialAPI()}initialAPI(){var t=this;return(0,c.A)(function*(){yield t.get_user(),yield t.isAdmin(),yield t.get_role_access()})()}service_message(t,s,n){this.messageService.add({severity:t,summary:s,detail:n})}onRoleChange(t){const s=this.roleList.find(n=>n.value===t.value);this.data_update.description=s?s.description:""}get_user(){var t=this;return(0,c.A)(function*(){t.api.users_get().then(s=>{t.users=s.data}).catch(s=>{console.log(s),t.service_message("warn","ERROR","Tidak Ada Data yang Ditampilkan")})})()}get_role_access(){var t=this;return(0,c.A)(function*(){t.api.role_get().then(s=>{t.role_access=s.data}).catch(s=>{console.log(s)})})()}create_new(){this.add_dialog=!0}isAdmin(){return(0,c.A)(function*(){return"manager"===localStorage.getItem("_rolePerm")})()}generateRandomId(t){let n="";for(let o=0;o<t;o++)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return n}add_user(){if(!this.username&&!this.password)return void this.service_message("error","ERROR","Form Cannot be Blank!");const t={id_user:this.generateRandomId(10),username:this.username,password:this.password,id_access:this.selectedRole.id_access,modified_by:JSON.parse(localStorage.getItem("_userInfo")).username};this.api.insertUser_post(t).then(s=>{200==s.status?(this.service_message("success","SUCCESS","Berhasil Menambahkan User"),this.add_dialog=!1,this.username=null,this.password=null,this.selectedRole=null,this.get_user()):400==s.status&&this.service_message("warn","ERROR","Username sudah ada")}).catch(s=>{console.log(s),this.service_message("warn","ERROR","Gagal Menambahkan User")})}close_add_dialog(){this.add_dialog=!1,this.username=null,this.password=null,this.selectedRole=null}update_data(t){this.edit_dialog=!0,this.data_update={...t}}updating(t){this.api.updateUser_post({username:t.username,role_access_id:t.role_perm}).then(n=>{console.log(n),this.service_message("success","SUCCESS","Berhasil Update Data"),this.get_user(),this.close_edit_dialog()}).catch(n=>{console.log(n),this.service_message("warn","ERROR","Gagal Update Data / Tidak Ada Data yang Dirubah")})}close_edit_dialog(){this.edit_dialog=!1,this.data_update=null}confirm(t,s){this.confirmationService.confirm({target:t.target,message:"Do you want to delete this record?",header:"Delete Confirmation",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger p-button-text",rejectButtonStyleClass:"p-button-text p-button-text",acceptIcon:"none",rejectIcon:"none",accept:()=>{this.api.deleteUser_post({username:s.username}).then(n=>{this.service_message("info","Confirmed","Record Telah Dihapus"),this.get_user()}).catch(n=>{this.service_message("error","Failed","Gagal Menghapus Data")}),this.get_user()},reject:()=>{this.service_message("error","Rejected","Batal Menghapus Data")}})}static{this.\u0275fac=function(s){return new(s||a)(e.rXU(d.bg),e.rXU(x.G),e.rXU(d.td))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-users"]],decls:18,vars:27,consts:[["dt",""],[1,"col-12","card"],["styleClass","mb-4 gap-2"],["pTemplate","left"],["class","col-12",4,"ngIf"],["dataKey","username","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",3,"selectionChange","value","rows","paginator","globalFilterFields","tableStyle","selection","rowHover","showCurrentPageReport"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["p-dialog","","header","Add User",3,"visibleChange","modal","draggable","visible","resizable","closable"],["pTemplate","content"],["pTemplate","footer"],["p-dialog","","header","Edit User",3,"visibleChange","modal","draggable","visible","resizable","closable"],["pRipple","","severity","success","label","Add User","icon","pi pi-user-plus",1,"mr-2",3,"click","disabled"],["pRipple","","severity","danger","label","Delete User","icon","pi pi-trash",3,"disabled"],[1,"col-12"],["mode","indeterminate"],[1,"flex","align-items-center","justify-content-between"],[1,"m-0"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Search...",3,"input"],["pSortableColumn","username"],["field","username"],["pSortableColumn","role_perm"],["field","role_perm"],[3,"value"],["pButton","","pRipple","","icon","pi pi-pencil",1,"mr-2","p-button-rounded","p-button-warn","p-button-outlined",3,"click"],["pButton","","pRipple","","icon","pi pi-trash","severity","danger",1,"ml-2","p-button-rounded","p-button-danger","p-button-outlined",3,"click","outlined","disabled"],[1,"p-fluid"],["for","username"],[2,"font-weight","bold"],["type","text","pInputText","","id","username",3,"ngModelChange","ngModel"],[1,"p-fluid","mt-3"],["for","password"],[3,"ngModelChange","ngModel","toggleMask"],["for","Role Access"],["appendTo","body","optionLabel","role_perm","placeholder","Select a Role",3,"ngModelChange","options","ngModel","checkmark","showClear"],["pButton","","pRipple","","label","Cancel","icon","pi pi-times",1,"p-button-text",3,"click"],["pButton","","pRipple","","label","Save","icon","pi pi-check",1,"p-button-text",3,"click"],["type","text","pInputText","","id","username",3,"ngModelChange","ngModel","disabled"],["appendTo","body","optionLabel","label","optionValue","value","placeholder","Select a Role",3,"ngModelChange","onChange","options","ngModel","showClear"],["for","Role Description"],["type","text","pInputText","","id","Role Description",3,"ngModelChange","ngModel","disabled"]],template:function(s,n){if(1&s){const o=e.RV6();e.nrm(0,"p-toast")(1,"p-confirmDialog"),e.j41(2,"div",1)(3,"p-toolbar",2),e.DNE(4,F,2,2,"ng-template",3),e.k0s()(),e.DNE(5,D,2,3,"div",4),e.j41(6,"div",1)(7,"p-table",5,0),e.mxI("selectionChange",function(i){return e.eBV(o),e.DH7(n.selectedUsers,i)||(n.selectedUsers=i),e.Njj(i)}),e.DNE(9,S,6,0,"ng-template",6)(10,E,11,0,"ng-template",7)(11,V,10,5,"ng-template",8),e.k0s()(),e.j41(12,"p-dialog",9),e.mxI("visibleChange",function(i){return e.eBV(o),e.DH7(n.add_dialog,i)||(n.add_dialog=i),e.Njj(i)}),e.DNE(13,N,15,7,"ng-template",10)(14,A,2,0,"ng-template",11),e.k0s(),e.j41(15,"p-dialog",12),e.mxI("visibleChange",function(i){return e.eBV(o),e.DH7(n.edit_dialog,i)||(n.edit_dialog=i),e.Njj(i)}),e.DNE(16,X,15,7,"ng-template",10)(17,w,2,0,"ng-template",11),e.k0s()}2&s&&(e.R7$(5),e.Y8G("ngIf",n.loadingUsername),e.R7$(2),e.Y8G("value",n.users)("rows",10)("paginator",!0)("globalFilterFields",e.lJ4(23,I))("tableStyle",e.lJ4(24,y)),e.R50("selection",n.selectedUsers),e.Y8G("rowHover",!0)("showCurrentPageReport",!0),e.R7$(5),e.Aen(e.lJ4(25,G)),e.Y8G("modal",!0)("draggable",!1),e.R50("visible",n.add_dialog),e.Y8G("resizable",!1)("closable",!1),e.R7$(3),e.Aen(e.lJ4(26,G)),e.Y8G("modal",!0)("draggable",!1),e.R50("visible",n.edit_dialog),e.Y8G("resizable",!1)("closable",!1))},dependencies:[f.bT,p.XI,d.Ei,p.Tg,p.yc,p.S9,p.nA,C.l,R.n,g._f,g.$n,j.y8,v.M,U.T,_.S,k.z,T.ms,m.me,m.BC,m.vS,M._2]})}}return a})(),H=(()=>{class a{static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[b.iI.forChild([{path:"",component:Y}]),b.iI]})}}return a})();var O=l(1305),P=l(1599),J=l(102),L=l(935),z=l(494),$=l(4714),K=l(981);let Z=(()=>{class a{static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({providers:[d.bg,d.td,J.b],imports:[f.MD,H,p.bG,C.P,R.Z,g.tm,j.MB,v.m,U.F,_.u,O.f,P.e,T.kr,L.$,z.Ko,$.wZ,_.u,m.YN,K.O3,k.d,M.Ou]})}}return a})()}}]);